"use strict";
exports.id = 932;
exports.ids = [932];
exports.modules = {

/***/ 16932:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "command": () => (/* binding */ command)
/* harmony export */ });
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(71017);
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _tools_transformCodebase__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(60332);
/* harmony import */ var _shared_promptKeycloakVersion__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(82635);
/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(57147);
/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _tools_downloadAndExtractArchive__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(38367);
/* harmony import */ var _shared_customHandler_delegate__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(72138);
/* harmony import */ var make_fetch_happen__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(9525);
/* harmony import */ var make_fetch_happen__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(make_fetch_happen__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _tools_SemVer__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(12171);
/* harmony import */ var tsafe_assert__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(29041);









async function command(params) {
    const { buildContext } = params;
    const { hasBeenHandled } = (0,_shared_customHandler_delegate__WEBPACK_IMPORTED_MODULE_5__/* .maybeDelegateCommandToCustomHandler */ .q)({
        commandName: "initialize-email-theme",
        buildContext
    });
    if (hasBeenHandled) {
        return;
    }
    const emailThemeSrcDirPath = (0,path__WEBPACK_IMPORTED_MODULE_0__.join)(buildContext.themeSrcDirPath, "email");
    if (fs__WEBPACK_IMPORTED_MODULE_3__.existsSync(emailThemeSrcDirPath) &&
        fs__WEBPACK_IMPORTED_MODULE_3__.readdirSync(emailThemeSrcDirPath).length > 0) {
        console.warn(`There is already a non empty ${(0,path__WEBPACK_IMPORTED_MODULE_0__.relative)(process.cwd(), emailThemeSrcDirPath)} directory in your project. Aborting.`);
        process.exit(-1);
    }
    console.log("Initialize with the base email theme from which version of Keycloak?");
    let { keycloakVersion } = await (0,_shared_promptKeycloakVersion__WEBPACK_IMPORTED_MODULE_2__/* .promptKeycloakVersion */ .s)({
        // NOTE: This is arbitrary
        startingFromMajor: 17,
        excludeMajorVersions: [],
        doOmitPatch: false,
        buildContext
    });
    const getUrl = (keycloakVersion) => {
        return `https://repo1.maven.org/maven2/org/keycloak/keycloak-themes/${keycloakVersion}/keycloak-themes-${keycloakVersion}.jar`;
    };
    keycloakVersion = await (async () => {
        const keycloakVersionParsed = _tools_SemVer__WEBPACK_IMPORTED_MODULE_7__/* .SemVer.parse */ .h.parse(keycloakVersion);
        while (true) {
            const url = getUrl(_tools_SemVer__WEBPACK_IMPORTED_MODULE_7__/* .SemVer.stringify */ .h.stringify(keycloakVersionParsed));
            const response = await make_fetch_happen__WEBPACK_IMPORTED_MODULE_6___default()(url, buildContext.fetchOptions);
            if (response.ok) {
                break;
            }
            (0,tsafe_assert__WEBPACK_IMPORTED_MODULE_8__/* .assert */ .h)(keycloakVersionParsed.patch !== 0);
            keycloakVersionParsed.patch--;
        }
        return _tools_SemVer__WEBPACK_IMPORTED_MODULE_7__/* .SemVer.stringify */ .h.stringify(keycloakVersionParsed);
    })();
    const { extractedDirPath } = await (0,_tools_downloadAndExtractArchive__WEBPACK_IMPORTED_MODULE_4__/* .downloadAndExtractArchive */ .I)({
        url: getUrl(keycloakVersion),
        cacheDirPath: buildContext.cacheDirPath,
        fetchOptions: buildContext.fetchOptions,
        uniqueIdOfOnArchiveFile: "extractOnlyEmailTheme",
        onArchiveFile: async ({ fileRelativePath, writeFile }) => {
            const fileRelativePath_target = (0,path__WEBPACK_IMPORTED_MODULE_0__.relative)((0,path__WEBPACK_IMPORTED_MODULE_0__.join)("theme", "base", "email"), fileRelativePath);
            if (fileRelativePath_target.startsWith("..")) {
                return;
            }
            await writeFile({ fileRelativePath: fileRelativePath_target });
        }
    });
    (0,_tools_transformCodebase__WEBPACK_IMPORTED_MODULE_1__/* .transformCodebase */ .N)({
        srcDirPath: extractedDirPath,
        destDirPath: emailThemeSrcDirPath
    });
    {
        const themePropertyFilePath = (0,path__WEBPACK_IMPORTED_MODULE_0__.join)(emailThemeSrcDirPath, "theme.properties");
        fs__WEBPACK_IMPORTED_MODULE_3__.writeFileSync(themePropertyFilePath, Buffer.from([
            `parent=base`,
            fs__WEBPACK_IMPORTED_MODULE_3__.readFileSync(themePropertyFilePath).toString("utf8")
        ].join("\n"), "utf8"));
    }
    console.log(`The \`${(0,path__WEBPACK_IMPORTED_MODULE_0__.join)(".", (0,path__WEBPACK_IMPORTED_MODULE_0__.relative)(process.cwd(), emailThemeSrcDirPath))}\` directory have been created.`);
    console.log("You can delete any file you don't modify.");
}
//# sourceMappingURL=initialize-email-theme.js.map

/***/ }),

/***/ 72138:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {


// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "q": () => (/* binding */ maybeDelegateCommandToCustomHandler)
});

// EXTERNAL MODULE: ./node_modules/tsafe/esm/assert.mjs + 1 modules
var esm_assert = __webpack_require__(29041);
// EXTERNAL MODULE: ./dist/bin/shared/constants.js
var constants = __webpack_require__(173);
;// CONCATENATED MODULE: ./dist/bin/shared/customHandler.js


const BIN_NAME = "_keycloakify-custom-handler";
const NOT_IMPLEMENTED_EXIT_CODE = 78;
function readParams(params) {
    const { apiVersion } = params;
    assert(apiVersion === "v1");
    const commandName = (() => {
        const envValue = process.env[CUSTOM_HANDLER_ENV_NAMES.COMMAND_NAME];
        assert(envValue !== undefined);
        return envValue;
    })();
    const buildContext = (() => {
        const envValue = process.env[CUSTOM_HANDLER_ENV_NAMES.BUILD_CONTEXT];
        assert(envValue !== undefined);
        return JSON.parse(envValue);
    })();
    return { commandName, buildContext };
}
//# sourceMappingURL=customHandler.js.map
// EXTERNAL MODULE: external "child_process"
var external_child_process_ = __webpack_require__(32081);
// EXTERNAL MODULE: external "path"
var external_path_ = __webpack_require__(71017);
// EXTERNAL MODULE: external "fs"
var external_fs_ = __webpack_require__(57147);
;// CONCATENATED MODULE: ./dist/bin/shared/customHandler_delegate.js






(0,esm_assert/* assert */.h)();
function maybeDelegateCommandToCustomHandler(params) {
    const { commandName, buildContext } = params;
    const nodeModulesBinDirPath = (() => {
        const binPath = process.argv[1];
        const segments = [".bin"];
        let foundNodeModules = false;
        for (const segment of binPath.split(external_path_.sep).reverse()) {
            skip_segment: {
                if (foundNodeModules) {
                    break skip_segment;
                }
                if (segment === "node_modules") {
                    foundNodeModules = true;
                    break skip_segment;
                }
                continue;
            }
            segments.unshift(segment);
        }
        return segments.join(external_path_.sep);
    })();
    if (!external_fs_.readdirSync(nodeModulesBinDirPath).includes(BIN_NAME)) {
        return { hasBeenHandled: false };
    }
    try {
        external_child_process_.execSync(`npx ${BIN_NAME}`, {
            stdio: "inherit",
            env: Object.assign(Object.assign({}, process.env), { [constants/* CUSTOM_HANDLER_ENV_NAMES.COMMAND_NAME */._S.COMMAND_NAME]: commandName, [constants/* CUSTOM_HANDLER_ENV_NAMES.BUILD_CONTEXT */._S.BUILD_CONTEXT]: JSON.stringify(buildContext) })
        });
    }
    catch (error) {
        const status = error.status;
        if (status === NOT_IMPLEMENTED_EXIT_CODE) {
            return { hasBeenHandled: false };
        }
        process.exit(status);
    }
    return { hasBeenHandled: true };
}
//# sourceMappingURL=customHandler_delegate.js.map

/***/ }),

/***/ 89693:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "a": () => (/* binding */ rmSync)
/* harmony export */ });
/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(57147);
/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(71017);
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _SemVer__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(12171);



/**
 * Polyfill of fs.rmSync(dirPath, { "recursive": true })
 * For older version of Node
 */
function rmSync(dirPath, options) {
    if (_SemVer__WEBPACK_IMPORTED_MODULE_2__/* .SemVer.compare */ .h.compare(_SemVer__WEBPACK_IMPORTED_MODULE_2__/* .SemVer.parse */ .h.parse(process.version), _SemVer__WEBPACK_IMPORTED_MODULE_2__/* .SemVer.parse */ .h.parse("14.14.0")) > 0) {
        fs__WEBPACK_IMPORTED_MODULE_0__.rmSync(dirPath, options);
        return;
    }
    const { force = true } = options;
    if (force && !fs__WEBPACK_IMPORTED_MODULE_0__.existsSync(dirPath)) {
        return;
    }
    const removeDir_rec = (dirPath) => fs__WEBPACK_IMPORTED_MODULE_0__.readdirSync(dirPath).forEach(basename => {
        const fileOrDirPath = (0,path__WEBPACK_IMPORTED_MODULE_1__.join)(dirPath, basename);
        if (fs__WEBPACK_IMPORTED_MODULE_0__.lstatSync(fileOrDirPath).isDirectory()) {
            removeDir_rec(fileOrDirPath);
            return;
        }
        else {
            fs__WEBPACK_IMPORTED_MODULE_0__.unlinkSync(fileOrDirPath);
        }
    });
    removeDir_rec(dirPath);
}
//# sourceMappingURL=fs.rmSync.js.map

/***/ }),

/***/ 60332:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "N": () => (/* binding */ transformCodebase)
/* harmony export */ });
/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(57147);
/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(71017);
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _crawl__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(73036);
/* harmony import */ var _tools_fs_rmSync__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(89693);




/**
 * Apply a transformation function to every file of directory
 * If source and destination are the same this function can be used to apply the transformation in place
 * like filtering out some files or modifying them.
 * */
function transformCodebase(params) {
    const { srcDirPath, transformSourceCode } = params;
    const isTargetSameAsSource = path__WEBPACK_IMPORTED_MODULE_1__.relative(srcDirPath, params.destDirPath) === "";
    const destDirPath = isTargetSameAsSource
        ? path__WEBPACK_IMPORTED_MODULE_1__.join(srcDirPath, "..", "tmp_xOsPdkPsTdzPs34sOkHs")
        : params.destDirPath;
    fs__WEBPACK_IMPORTED_MODULE_0__.mkdirSync(destDirPath, {
        recursive: true
    });
    for (const fileRelativePath of (0,_crawl__WEBPACK_IMPORTED_MODULE_2__/* .crawl */ .J)({
        dirPath: srcDirPath,
        returnedPathsType: "relative to dirPath"
    })) {
        const filePath = path__WEBPACK_IMPORTED_MODULE_1__.join(srcDirPath, fileRelativePath);
        const destFilePath = path__WEBPACK_IMPORTED_MODULE_1__.join(destDirPath, fileRelativePath);
        // NOTE: Optimization, if we don't need to transform the file, just copy
        // it using the lower level implementation.
        if (transformSourceCode === undefined) {
            fs__WEBPACK_IMPORTED_MODULE_0__.mkdirSync(path__WEBPACK_IMPORTED_MODULE_1__.dirname(destFilePath), {
                recursive: true
            });
            fs__WEBPACK_IMPORTED_MODULE_0__.copyFileSync(filePath, destFilePath);
            continue;
        }
        const transformSourceCodeResult = transformSourceCode({
            sourceCode: fs__WEBPACK_IMPORTED_MODULE_0__.readFileSync(filePath),
            filePath,
            fileRelativePath
        });
        if (transformSourceCodeResult === undefined) {
            continue;
        }
        fs__WEBPACK_IMPORTED_MODULE_0__.mkdirSync(path__WEBPACK_IMPORTED_MODULE_1__.dirname(destFilePath), {
            recursive: true
        });
        const { newFileName, modifiedSourceCode } = transformSourceCodeResult;
        fs__WEBPACK_IMPORTED_MODULE_0__.writeFileSync(path__WEBPACK_IMPORTED_MODULE_1__.join(path__WEBPACK_IMPORTED_MODULE_1__.dirname(destFilePath), newFileName !== null && newFileName !== void 0 ? newFileName : path__WEBPACK_IMPORTED_MODULE_1__.basename(destFilePath)), modifiedSourceCode);
    }
    if (isTargetSameAsSource) {
        (0,_tools_fs_rmSync__WEBPACK_IMPORTED_MODULE_3__/* .rmSync */ .a)(srcDirPath, { recursive: true });
        fs__WEBPACK_IMPORTED_MODULE_0__.renameSync(destDirPath, srcDirPath);
    }
}
//# sourceMappingURL=transformCodebase.js.map

/***/ })

};
;